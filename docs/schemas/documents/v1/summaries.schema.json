{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://alan-jowett.github.io/CoPilot-For-Consensus/schemas/documents/summaries.schema.json",
  "title": "summaries collection",
  "type": "object",
  "properties": {
    "_id": {
      "type": "string",
      "minLength": 16,
      "maxLength": 16,
      "pattern": "^[A-Fa-f0-9]{16}$",
      "description": "Deterministic summary identifier (e.g., derived from thread_id, summary_type, and inputs)"
    },
    "thread_id": {
      "type": "string",
      "minLength": 16,
      "maxLength": 16,
      "pattern": "^[A-Fa-f0-9]{16}$"
    },
    "summary_type": { "type": "string", "enum": ["thread", "weekly", "consensus", "draft-focused"] },
    "title": { "type": "string" },
    "content_markdown": { "type": "string", "minLength": 1 },
    "content_html": { "type": "string" },
    "citations": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "chunk_id": {
            "type": "string",
            "minLength": 16,
            "maxLength": 16,
            "pattern": "^[A-Fa-f0-9]{16}$",
            "description": "SHA256 hash chunk identifier"
          },
          "message_id": { "type": "string", "minLength": 1 },
          "quote": { "type": "string" },
          "relevance_score": { "type": "number", "minimum": 0, "maximum": 1 }
        },
        "required": ["chunk_id", "message_id"],
        "additionalProperties": false
      },
      "minItems": 0
    },
    "generated_by": { "type": "string" },
    "generated_at": { "type": "string", "format": "date-time" },
    "first_message_date": {
      "type": ["string", "null"],
      "format": "date-time",
      "description": "Denormalized from thread: date of the first message in the thread"
    },
    "last_message_date": {
      "type": ["string", "null"],
      "format": "date-time",
      "description": "Denormalized from thread: date of the last message in the thread"
    },
    "metadata": { "type": "object" }
  },
  "required": ["_id", "summary_type", "generated_at", "content_markdown"]
}
