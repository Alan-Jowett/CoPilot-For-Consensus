{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "service_name": "reporting",
  "schema_version": "1.0.0",
  "min_service_version": "0.1.0",
  "metadata": {
    "description": "Reporting service configuration schema",
    "version": "1.0.0"
  },
  "fields": {
    "message_bus_type": {
      "type": "string",
      "source": "env",
      "env_var": "MESSAGE_BUS_TYPE",
      "required": true,
      "description": "Message bus type (rabbitmq, servicebus)"
    },
    "servicebus_use_managed_identity": {
      "type": "bool",
      "source": "env",
      "env_var": "SERVICEBUS_USE_MANAGED_IDENTITY",
      "default": true,
      "required": false,
      "description": "Use Azure managed identity for Service Bus authentication (when MESSAGE_BUS_TYPE=servicebus)"
    },
    "servicebus_fully_qualified_namespace": {
      "type": "string",
      "source": "env",
      "env_var": "SERVICEBUS_FULLY_QUALIFIED_NAMESPACE",
      "required": false,
      "description": "Azure Service Bus fully qualified namespace (when MESSAGE_BUS_TYPE=servicebus, e.g., mybus.servicebus.windows.net)"
    },
    "rabbitmq_host": {
      "type": "string",
      "source": "env",
      "env_var": "RABBITMQ_HOST",
      "default": "messagebus",
      "description": "Message bus hostname"
    },
    "rabbitmq_port": {
      "type": "int",
      "source": "env",
      "env_var": "RABBITMQ_PORT",
      "default": 5672,
      "description": "Message bus port"
    },
    "rabbitmq_username": {
      "type": "string",
      "source": "secret",
      "secret_name": "rabbitmq_username",
      "required": false,
      "description": "RabbitMQ username (secret)"
    },
    "rabbitmq_password": {
      "type": "string",
      "source": "secret",
      "secret_name": "rabbitmq_password",
      "required": false,
      "description": "RabbitMQ password (secret)"
    },
    "doc_store_type": {
      "type": "string",
      "source": "env",
      "env_var": "DOCUMENT_STORE_TYPE",
      "required": true,
      "description": "Document store type"
    },
    "doc_store_host": {
      "type": "string",
      "source": "env",
      "env_var": "COSMOS_ENDPOINT",
      "default": "documentdb",
      "description": "Document store hostname"
    },
    "doc_store_port": {
      "type": "int",
      "source": "env",
      "env_var": "COSMOS_PORT",
      "default": 27017,
      "description": "Document store port"
    },
    "doc_store_name": {
      "type": "string",
      "source": "env",
      "env_var": "COSMOS_DATABASE",
      "default": "copilot",
      "description": "Document store database name"
    },
    "doc_store_user": {
      "type": "string",
      "source": "secret",
      "secret_name": "document_database_user",
      "required": false,
      "description": "Document store username (secret)"
    },
    "doc_store_password": {
      "type": "string",
      "source": "secret",
      "secret_name": "document_database_password",
      "required": false,
      "description": "Document store password (secret)"
    },
    "notify_enabled": {
      "type": "bool",
      "source": "env",
      "env_var": "NOTIFY_ENABLED",
      "default": false,
      "description": "Enable webhook notifications"
    },
    "notify_webhook_url": {
      "type": "string",
      "source": "env",
      "env_var": "NOTIFY_WEBHOOK_URL",
      "default": "",
      "description": "Webhook URL for notifications"
    },
    "webhook_summary_max_length": {
      "type": "int",
      "source": "env",
      "env_var": "WEBHOOK_SUMMARY_MAX_LENGTH",
      "default": 500,
      "description": "Maximum length of summary in webhook notifications"
    },
    "http_port": {
      "type": "int",
      "source": "env",
      "env_var": "HTTP_PORT",
      "default": 8080,
      "description": "HTTP server port"
    },
    "metrics_type": {
      "type": "string",
      "source": "env",
      "env_var": "METRICS_TYPE",
      "required": true,
      "description": "Metrics backend type (prometheus, pushgateway, azure_monitor, noop)"
    },
    "prometheus_pushgateway": {
      "type": "string",
      "source": "env",
      "env_var": "PROMETHEUS_PUSHGATEWAY",
      "required": false,
      "description": "Pushgateway base URL when metrics_type=pushgateway (e.g., http://pushgateway:9091)"
    },
    "error_reporter_type": {
      "type": "string",
      "source": "env",
      "env_var": "ERROR_REPORTER_TYPE",
      "required": true,
      "description": "Error reporter type"
    },
    "jwt_auth_enabled": {
      "type": "bool",
      "source": "env",
      "env_var": "JWT_AUTH_ENABLED",
      "default": true,
      "description": "Enable JWT authentication middleware"
    },
    "vector_store_type": {
      "type": "string",
      "source": "env",
      "env_var": "VECTOR_STORE_TYPE",
      "required": true,
      "description": "Vector store type (e.g., qdrant, faiss). Leave empty to disable topic search. Set to 'qdrant' in docker-compose for production use."
    },
    "vector_store_host": {
      "type": "string",
      "source": "env",
      "env_var": "QDRANT_HOST",
      "default": "vectorstore",
      "description": "Vector store hostname"
    },
    "vector_store_port": {
      "type": "int",
      "source": "env",
      "env_var": "QDRANT_PORT",
      "default": 6333,
      "description": "Vector store port"
    },
    "vector_store_collection": {
      "type": "string",
      "source": "env",
      "env_var": "QDRANT_COLLECTION",
      "default": "embeddings",
      "description": "Vector store collection name"
    },
    "embedding_backend": {
      "type": "string",
      "source": "env",
      "env_var": "EMBEDDING_BACKEND",
      "required": true,
      "description": "Embedding backend (e.g., sentencetransformers, openai, azure)"
    },
    "SENTENCETRANSFORMERS_MODEL": {
      "type": "string",
      "source": "env",
      "env_var": "SENTENCETRANSFORMERS_MODEL",
      "default": "all-MiniLM-L6-v2",
      "description": "Embedding model name"
    },
    "SENTENCETRANSFORMERS_SENTENCETRANSFORMERS_DEVICE": {
      "type": "string",
      "source": "env",
      "env_var": "SENTENCETRANSFORMERS_SENTENCETRANSFORMERS_DEVICE",
      "default": "cpu",
      "description": "SENTENCETRANSFORMERS_SENTENCETRANSFORMERS_DEVICE for embedding generation (cpu, cuda)"
    }
  }
}
