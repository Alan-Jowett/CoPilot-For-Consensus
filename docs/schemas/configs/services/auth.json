{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$comment": "SPDX-License-Identifier: MIT\nCopyright (c) 2025 Copilot-for-Consensus contributors",
    "service_name": "auth",
    "schema_version": "1.0.0",
    "min_service_version": "0.1.0",
    "metadata": {
        "description": "Authentication service configuration schema",
        "version": "1.0.0"
    },
    "service_settings": {
        "audiences": {
            "type": "string",
            "source": "env",
            "env_var": "AUTH_AUDIENCES",
            "default": "copilot-for-consensus",
            "description": "Comma-separated list of allowed JWT audiences"
        },
        "enable_dpop": {
            "type": "bool",
            "source": "env",
            "env_var": "AUTH_ENABLE_DPOP",
            "default": false,
            "description": "Enable DPoP proof-of-possession tokens"
        },
        "first_user_auto_promotion_enabled": {
            "type": "bool",
            "source": "env",
            "env_var": "AUTH_FIRST_USER_AUTO_PROMOTION_ENABLED",
            "default": false,
            "description": "Enable auto-promotion of first user to admin (only for development/testing)"
        },
        "issuer": {
            "type": "string",
            "source": "env",
            "env_var": "AUTH_ISSUER",
            "default": "http://localhost:8090",
            "required": true,
            "description": "JWT issuer URL"
        },
        "jwt_algorithm": {
            "type": "string",
            "source": "env",
            "env_var": "AUTH_JWT_ALGORITHM",
            "default": "RS256",
            "description": "JWT signing algorithm (RS256 or HS256)"
        },
        "jwt_default_expiry": {
            "type": "int",
            "source": "env",
            "env_var": "AUTH_JWT_DEFAULT_EXPIRY",
            "default": 1800,
            "description": "Default JWT token lifetime in seconds"
        },
        "jwt_key_id": {
            "type": "string",
            "source": "env",
            "env_var": "AUTH_JWT_KEY_ID",
            "default": "default",
            "description": "Key ID for key rotation"
        },
        "jwt_private_key": {
            "type": "string",
            "source": "secret",
            "secret_name": "jwt_private_key",
            "required": false,
            "description": "RSA private key for JWT signing (PEM format, RS256 only)"
        },
        "jwt_public_key": {
            "type": "string",
            "source": "secret",
            "secret_name": "jwt_public_key",
            "required": false,
            "description": "RSA public key for JWT verification (PEM format, RS256 only)"
        },
        "jwt_secret_key": {
            "type": "string",
            "source": "secret",
            "secret_name": "jwt_secret_key",
            "required": false,
            "description": "HMAC secret for JWT signing (HS256 only)"
        },
        "max_skew_seconds": {
            "type": "int",
            "source": "env",
            "env_var": "AUTH_MAX_SKEW_SECONDS",
            "default": 90,
            "description": "Maximum clock skew tolerance in seconds"
        },
        "require_nonce": {
            "type": "bool",
            "source": "env",
            "env_var": "AUTH_REQUIRE_NONCE",
            "default": true,
            "description": "Require nonce for OIDC flows"
        },
        "require_pkce": {
            "type": "bool",
            "source": "env",
            "env_var": "AUTH_REQUIRE_PKCE",
            "default": true,
            "description": "Require PKCE for OAuth flows"
        },
        "role_store_schema_dir": {
            "type": "string",
            "source": "env",
            "env_var": "AUTH_ROLE_STORE_SCHEMA_DIR",
            "required": false,
            "description": "Filesystem directory containing user role schema for validation"
        },
        "role_store_collection": {
            "type": "string",
            "source": "env",
            "env_var": "AUTH_ROLE_STORE_COLLECTION",
            "default": "user_roles",
            "description": "MongoDB collection name for user roles"
        },
        "auto_approve_enabled": {
            "type": "bool",
            "source": "env",
            "env_var": "AUTH_AUTO_APPROVE_ENABLED",
            "default": false,
            "description": "Automatically approve first-time users into default roles"
        },
        "auto_approve_roles": {
            "type": "string",
            "source": "env",
            "env_var": "AUTH_AUTO_APPROVE_ROLES",
            "required": false,
            "description": "Comma-separated roles to grant when auto-approving users"
        },
        "cookie_secure": {
            "type": "bool",
            "source": "env",
            "env_var": "AUTH_COOKIE_SECURE",
            "default": false,
            "description": "Enable secure flag for auth_token cookie (requires HTTPS)"
        },
        "port": {
            "type": "int",
            "source": "env",
            "env_var": "AUTH_PORT",
            "default": 8090,
            "description": "HTTP server port"
        },
        "host": {
            "type": "string",
            "source": "env",
            "env_var": "AUTH_HOST",
            "default": "0.0.0.0",
            "description": "HTTP server host"
        }
    },
    "adapters": {
        "document_store": {
            "$ref": "../adapters/document_store.json"
        },
        "metrics": {
            "$ref": "../adapters/metrics.json"
        },
        "oidc_providers": {
            "$ref": "../adapters/oidc_providers.json"
        },
        "secret_provider": {
            "$ref": "../adapters/secret_provider.json"
        }
    }
}