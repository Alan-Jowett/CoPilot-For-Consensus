{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$comment": "SPDX-License-Identifier: MIT\nCopyright (c) 2025 Copilot-for-Consensus contributors",
    "title": "RabbitMQ driver settings",
    "type": "object",
    "properties": {
        "rabbitmq_host": {
            "type": "string",
            "source": "env",
            "env_var": "RABBITMQ_HOST",
            "default": "messagebus",
            "description": "RabbitMQ hostname"
        },
        "rabbitmq_port": {
            "type": "int",
            "source": "env",
            "env_var": "RABBITMQ_PORT",
            "default": 5672,
            "description": "RabbitMQ port"
        },
        "rabbitmq_username": {
            "type": "string",
            "source": "secret",
            "secret_name": "rabbitmq_user",
            "required": true,
            "description": "RabbitMQ username"
        },
        "rabbitmq_password": {
            "type": "string",
            "source": "secret",
            "secret_name": "rabbitmq_password",
            "required": true,
            "description": "RabbitMQ password"
        },
        "exchange": {
            "type": "string",
            "default": "copilot.events",
            "description": "RabbitMQ exchange name for publishing"
        },
        "exchange_type": {
            "type": "string",
            "default": "topic",
            "enum": ["topic", "direct", "fanout", "headers"],
            "description": "RabbitMQ exchange type"
        },
        "queue_name": {
            "type": "string",
            "required": false,
            "description": "RabbitMQ queue name (optional for subscribers)"
        },
        "queue_durable": {
            "type": "bool",
            "default": true,
            "description": "Whether the queue survives broker restart"
        },
        "exchange_name": {
            "type": "string",
            "default": "copilot.events",
            "description": "RabbitMQ exchange name for subscribing"
        },
        "auto_ack": {
            "type": "bool",
            "default": false,
            "description": "Automatically acknowledge messages after processing"
        },
        "heartbeat": {
            "type": "int",
            "source": "env",
            "env_var": "RABBITMQ_HEARTBEAT",
            "default": 300,
            "description": "Heartbeat interval in seconds (default: 300). Higher values reduce network overhead and prevent disconnects during CPU-intensive tasks. Set to 0 to disable (not recommended)."
        },
        "blocked_connection_timeout": {
            "type": "int",
            "source": "env",
            "env_var": "RABBITMQ_BLOCKED_CONNECTION_TIMEOUT",
            "default": 600,
            "description": "Timeout in seconds for blocked connections due to TCP backpressure (default: 600). Should be at least 2x the heartbeat interval."
        }
    },
    "required": ["rabbitmq_host", "rabbitmq_port", "rabbitmq_username", "rabbitmq_password"]
}
