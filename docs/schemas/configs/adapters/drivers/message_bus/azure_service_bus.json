{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$comment": "SPDX-License-Identifier: MIT\nCopyright (c) 2025 Copilot-for-Consensus contributors",
    "title": "Azure Service Bus driver settings",
    "type": "object",
    "x-conditional_required": [
        {
            "if": {
                "field": "servicebus_use_managed_identity",
                "equals": true
            },
            "then_required": [
                "servicebus_fully_qualified_namespace"
            ],
            "else_required": [
                "connection_string"
            ]
        }
    ],
    "properties": {
        "connection_string": {
            "type": "string",
            "source": "env",
            "env_var": [
                "MESSAGE_BUS_CONNECTION_STRING",
                "SERVICEBUS_CONNECTION_STRING"
            ],
            "required": false,
            "minLength": 1,
            "description": "Azure Service Bus connection string (used when not using managed identity)"
        },
        "servicebus_fully_qualified_namespace": {
            "type": "string",
            "source": "env",
            "env_var": [
                "MESSAGE_BUS_FULLY_QUALIFIED_NAMESPACE",
                "SERVICEBUS_FULLY_QUALIFIED_NAMESPACE"
            ],
            "required": false,
            "minLength": 1,
            "description": "Azure Service Bus fully qualified namespace"
        },
        "servicebus_use_managed_identity": {
            "type": "bool",
            "source": "env",
            "env_var": [
                "MESSAGE_BUS_USE_MANAGED_IDENTITY",
                "SERVICEBUS_USE_MANAGED_IDENTITY"
            ],
            "default": false,
            "description": "Use managed identity for Service Bus access"
        },
        "queue_name": {
            "type": "string",
            "required": false,
            "minLength": 1,
            "description": "Azure Service Bus queue name (optional)"
        },
        "topic_name": {
            "type": "string",
            "required": false,
            "minLength": 1,
            "description": "Azure Service Bus topic name (optional)"
        },
        "subscription_name": {
            "type": "string",
            "required": false,
            "minLength": 1,
            "description": "Azure Service Bus subscription name (optional, required if topic_name is set)"
        },
        "auto_complete": {
            "type": "bool",
            "default": false,
            "description": "Automatically complete messages after processing"
        },
        "max_wait_time": {
            "type": "int",
            "default": 5,
            "description": "Maximum time to wait for messages in seconds"
        }
    }
}
