{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$comment": "SPDX-License-Identifier: MIT\nCopyright (c) 2025 Copilot-for-Consensus contributors",
    "title": "Azure Key Vault JWT Signer driver settings",
    "type": "object",
    "properties": {
        "algorithm": {
            "type": "string",
            "source": "env",
            "env_var": "AUTH_JWT_ALGORITHM",
            "default": "RS256",
            "enum": ["RS256", "RS384", "RS512", "ES256", "ES384", "ES512"],
            "description": "JWT signing algorithm (HMAC not supported with Key Vault)"
        },
        "key_id": {
            "type": "string",
            "source": "env",
            "env_var": "AUTH_JWT_KEY_ID",
            "default": "default",
            "description": "Key identifier for key rotation support"
        },
        "key_vault_url": {
            "type": "string",
            "source": "env",
            "env_var": "AZURE_KEY_VAULT_URI",
            "description": "Azure Key Vault URL (e.g., https://myvault.vault.azure.net/)"
        },
        "key_name": {
            "type": "string",
            "source": "env",
            "env_var": "JWT_KEY_NAME",
            "description": "Name of the key in Azure Key Vault"
        },
        "key_version": {
            "type": "string",
            "source": "env",
            "env_var": "JWT_KEY_VERSION",
            "required": false,
            "description": "Specific key version (optional, uses latest if not specified)"
        },
        "tenant_id": {
            "type": "string",
            "source": "env",
            "env_var": "AZURE_TENANT_ID",
            "required": false,
            "description": "Azure tenant ID (optional; managed identity may be used)"
        },
        "client_id": {
            "type": "string",
            "source": "env",
            "env_var": "AZURE_CLIENT_ID",
            "required": false,
            "description": "Azure client ID (optional; managed identity may be used)"
        },
        "client_secret": {
            "type": "string",
            "source": "env",
            "env_var": "AZURE_CLIENT_SECRET",
            "required": false,
            "description": "Azure client secret (optional; managed identity may be used)"
        },
        "max_retries": {
            "type": "int",
            "source": "env",
            "env_var": "JWT_SIGNER_MAX_RETRIES",
            "default": 3,
            "description": "Maximum number of retry attempts for transient errors"
        },
        "retry_delay": {
            "type": "float",
            "source": "env",
            "env_var": "JWT_SIGNER_RETRY_DELAY",
            "default": 0.5,
            "description": "Initial retry delay in seconds (uses exponential backoff)"
        },
        "circuit_breaker_threshold": {
            "type": "int",
            "source": "env",
            "env_var": "JWT_SIGNER_CIRCUIT_BREAKER_THRESHOLD",
            "default": 5,
            "description": "Number of consecutive failures before opening circuit breaker"
        },
        "circuit_breaker_timeout": {
            "type": "float",
            "source": "env",
            "env_var": "JWT_SIGNER_CIRCUIT_BREAKER_TIMEOUT",
            "default": 60.0,
            "description": "Seconds to wait before attempting half-open state"
        }
    },
    "required": ["algorithm", "key_id", "key_vault_url", "key_name"]
}
