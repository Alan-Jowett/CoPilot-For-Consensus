# SPDX-License-Identifier: MIT
# Copyright (c) 2025 Copilot-for-Consensus contributors

# Azure-optimized Dockerfile for gateway service
# Already optimized with nginx:alpine base image
FROM nginx:1.27.3-alpine@sha256:814a8e88df978ade80e584cc5b333144b9372a8e3c98872d07137dbf3b44d0e4

# Copy the nginx configuration template
# This will be processed by 30-substitute-env.sh entrypoint to inject backend URLs
COPY nginx.conf /etc/nginx/nginx.conf.template

# Copy custom entrypoints
# 30-substitute-env.sh: Substitute environment variables for backend URLs
# 40-configure-tls.sh: Enable TLS configuration if certificates are provided
COPY 30-substitute-env.sh /docker-entrypoint.d/30-substitute-env.sh
COPY docker-entrypoint.sh /docker-entrypoint.d/40-configure-tls.sh
RUN chmod +x /docker-entrypoint.d/30-substitute-env.sh /docker-entrypoint.d/40-configure-tls.sh
