# SPDX-License-Identifier: MIT
# Copyright (c) 2025 Copilot-for-Consensus contributors

# Azure-optimized Dockerfile for gateway service
# Already optimized with nginx:alpine base image
FROM nginx:1.29.4-alpine@sha256:7d7a15b8a280c661051955f14c2b91fed3e23724ddba18d2f53e8b44e74ab37a

# Copy the nginx configuration template
# This will be processed by 30-substitute-env.sh entrypoint to inject backend URLs
COPY nginx.conf /etc/nginx/nginx.conf.template

# Copy custom entrypoints
# 30-substitute-env.sh: Substitute environment variables for backend URLs
# 40-configure-tls.sh: Enable TLS configuration if certificates are provided
COPY 30-substitute-env.sh /docker-entrypoint.d/30-substitute-env.sh
COPY docker-entrypoint.sh /docker-entrypoint.d/40-configure-tls.sh
RUN chmod +x /docker-entrypoint.d/30-substitute-env.sh /docker-entrypoint.d/40-configure-tls.sh
