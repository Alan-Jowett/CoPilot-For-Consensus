# SPDX-License-Identifier: MIT
# Copyright (c) 2025 Copilot-for-Consensus contributors

# Azure-optimized Dockerfile for gateway service
# Already optimized with nginx:alpine base image
FROM nginx:1.29.5-alpine@sha256:1d13701a5f9f3fb01aaa88cef2344d65b6b5bf6b7d9fa4cf0dca557a8d7702ba

# Copy the nginx configuration template
# This will be processed by 30-substitute-env.sh entrypoint to inject backend URLs
COPY nginx.conf /etc/nginx/nginx.conf.template

# Copy custom entrypoints
# 30-substitute-env.sh: Substitute environment variables for backend URLs
# 40-configure-tls.sh: Enable TLS configuration if certificates are provided
COPY 30-substitute-env.sh /docker-entrypoint.d/30-substitute-env.sh
COPY docker-entrypoint.sh /docker-entrypoint.d/40-configure-tls.sh
RUN chmod +x /docker-entrypoint.d/30-substitute-env.sh /docker-entrypoint.d/40-configure-tls.sh
