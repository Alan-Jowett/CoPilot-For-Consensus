# SPDX-License-Identifier: MIT
# Copyright (c) 2025 Copilot-for-Consensus contributors

global:
  scrape_interval: 15s
  evaluation_interval: 15s

# Alert rules for failed queue monitoring
# NOTE: Ensure /etc/prometheus/alerts/ directory is mounted in the container.
# In Docker Compose, mount with: ./infra/prometheus/alerts:/etc/prometheus/alerts:ro
rule_files:
  - /etc/prometheus/alerts/*.yml

scrape_configs:
  - job_name: 'prometheus'
    static_configs:
      - targets: ['monitoring:9090']

  - job_name: 'copilot-services'
    static_configs:
      - targets: 
        - 'ingestion:8000'
        - 'parsing:8000'
        - 'chunking:8000'
        - 'embedding:8000'
        - 'orchestrator:8000'
        - 'summarization:8000'
        - 'reporting:8080'
        - 'error-reporting:8081'
    relabel_configs:
      - source_labels: [__address__]
        regex: '([^:]+):.*'
        target_label: service
        replacement: '$1'

  - job_name: 'pushgateway'
    static_configs:
      - targets:
          - 'pushgateway:9091'

  - job_name: 'rabbitmq'
    static_configs:
      - targets:
          - 'rabbitmq-exporter:9419'

  - job_name: 'mongodb'
    static_configs:
      - targets:
          - 'mongodb-exporter:9216'

  - job_name: 'mongo-doc-count'
    static_configs:
      - targets:
          - 'mongo-doc-count-exporter:9500'

  - job_name: 'cadvisor'
    static_configs:
      - targets:
          - 'cadvisor:8080'
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: 'cadvisor'

