# SPDX-License-Identifier: MIT
# Copyright (c) 2025 Copilot-for-Consensus contributors

# Top-level Docker Compose configuration
# This file orchestrates all services by including separate files for infrastructure and application services.
#
# Port Exposure Policy (see docs/operations/exposed-ports.md for details):
# - Public (0.0.0.0): Only Grafana (3000) and Reporting API (8080)
# - Localhost (127.0.0.1): Infrastructure, monitoring, and development services
# - No port mapping: Internal-only services (exporters, processors)
# This minimizes the attack surface while maintaining local development accessibility.

include:
  - path: docker-compose.infra.yml
  - path: docker-compose.services.yml

# Shared resources used by both infrastructure and application services
volumes:
  raw_archives:
  vector_data:
  mongo_data:
  prometheus_data:
  grafana_data:
  loki_data:
  llama_models:

secrets:
  # RabbitMQ credentials
  rabbitmq_user:
    file: ./secrets/rabbitmq_user
  rabbitmq_password:
    file: ./secrets/rabbitmq_password

  # MongoDB credentials
  mongodb_user:
    file: ./secrets/mongodb_user
  mongodb_password:
    file: ./secrets/mongodb_password

  # Grafana admin
  grafana_admin_user:
    file: ./secrets/grafana_admin_user
  grafana_admin_password:
    file: ./secrets/grafana_admin_password

  # Azure OpenAI
  azure_openai_key:
    file: ./secrets/azure_openai_key

  # Auth service JWT keys
  jwt_private_key:
    file: ./secrets/jwt_private_key
  jwt_public_key:
    file: ./secrets/jwt_public_key
  jwt_secret_key:
    file: ./secrets/jwt_secret_key

  # OAuth provider secrets
  github_oauth_client_id:
    file: ./secrets/github_oauth_client_id
  github_oauth_client_secret:
    file: ./secrets/github_oauth_client_secret
  google_oauth_client_secret:
    file: ./secrets/google_oauth_client_secret
  microsoft_oauth_client_secret:
    file: ./secrets/microsoft_oauth_client_secret

  # Auth role store
  role_store_password:
    file: ./secrets/role_store_password

  # API Gateway TLS certificates (optional)
  # Provide these secrets to enable HTTPS on port 8443
  gateway_tls_cert:
    file: ./secrets/gateway_tls_cert
  gateway_tls_key:
    file: ./secrets/gateway_tls_key
