{
  "service_name": "auth",
  "metadata": {
    "description": "Authentication service configuration schema",
    "version": "1.0.0"
  },
  "fields": {
    "secret_provider_type": {
      "type": "string",
      "source": "env",
      "env_var": "SECRET_PROVIDER_TYPE",
      "default": "local",
      "description": "Secret provider type (local, vault, etc.)"
    },
    "secrets_base_path": {
      "type": "string",
      "source": "env",
      "env_var": "SECRETS_BASE_PATH",
      "default": "/run/secrets",
      "description": "Base path for secret storage"
    },
    "issuer": {
      "type": "string",
      "source": "env",
      "env_var": "AUTH_ISSUER",
      "default": "http://localhost:8090",
      "required": true,
      "description": "JWT issuer URL"
    },
    "audiences": {
      "type": "string",
      "source": "env",
      "env_var": "AUTH_AUDIENCES",
      "default": "copilot-for-consensus",
      "description": "Comma-separated list of allowed JWT audiences"
    },
    "jwt_algorithm": {
      "type": "string",
      "source": "env",
      "env_var": "JWT_ALGORITHM",
      "default": "RS256",
      "description": "JWT signing algorithm (RS256 or HS256)"
    },
    "jwt_key_id": {
      "type": "string",
      "source": "env",
      "env_var": "JWT_KEY_ID",
      "default": "default",
      "description": "Key ID for key rotation"
    },
    "jwt_default_expiry": {
      "type": "int",
      "source": "env",
      "env_var": "JWT_DEFAULT_EXPIRY",
      "default": 1800,
      "description": "Default JWT token lifetime in seconds"
    },
    "jwt_private_key": {
      "type": "string",
      "source": "secret",
      "secret_name": "jwt_private_key",
      "required": false,
      "description": "RSA private key for JWT signing (PEM format, RS256 only)"
    },
    "jwt_public_key": {
      "type": "string",
      "source": "secret",
      "secret_name": "jwt_public_key",
      "required": false,
      "description": "RSA public key for JWT verification (PEM format, RS256 only)"
    },
    "jwt_secret_key": {
      "type": "string",
      "source": "secret",
      "secret_name": "jwt_secret_key",
      "required": false,
      "description": "HMAC secret for JWT signing (HS256 only)"
    },
    "github_client_id": {
      "type": "string",
      "source": "secret",
      "secret_name": "github_oauth_client_id",
      "required": false,
      "description": "GitHub OAuth client ID (stored in secrets store)"
    },
    "github_client_secret": {
      "type": "string",
      "source": "secret",
      "secret_name": "github_oauth_client_secret",
      "required": false,
      "description": "GitHub OAuth client secret"
    },
    "github_redirect_uri": {
      "type": "string",
      "source": "env",
      "env_var": "AUTH_GITHUB_REDIRECT_URI",
      "required": false,
      "description": "GitHub OAuth callback URL (defaults to {issuer}/callback)"
    },
    "github_api_base_url": {
      "type": "string",
      "source": "env",
      "env_var": "AUTH_GITHUB_API_BASE_URL",
      "default": "https://api.github.com",
      "description": "GitHub API base URL"
    },
    "google_client_id": {
      "type": "string",
      "source": "secret",
      "secret_name": "google_oauth_client_id",
      "required": false,
      "description": "Google OAuth client ID (stored in secrets store)"
    },
    "google_client_secret": {
      "type": "string",
      "source": "secret",
      "secret_name": "google_oauth_client_secret",
      "required": false,
      "description": "Google OAuth client secret"
    },
    "google_redirect_uri": {
      "type": "string",
      "source": "env",
      "env_var": "AUTH_GOOGLE_REDIRECT_URI",
      "required": false,
      "description": "Google OAuth callback URL (defaults to {issuer}/callback)"
    },
    "microsoft_client_id": {
      "type": "string",
      "source": "secret",
      "secret_name": "microsoft_oauth_client_id",
      "required": false,
      "description": "Microsoft OAuth client ID (stored in secrets store)"
    },
    "microsoft_client_secret": {
      "type": "string",
      "source": "secret",
      "secret_name": "microsoft_oauth_client_secret",
      "required": false,
      "description": "Microsoft OAuth client secret"
    },
    "microsoft_redirect_uri": {
      "type": "string",
      "source": "env",
      "env_var": "AUTH_MS_REDIRECT_URI",
      "required": false,
      "description": "Microsoft OAuth callback URL (defaults to {issuer}/callback)"
    },
    "microsoft_tenant": {
      "type": "string",
      "source": "env",
      "env_var": "AUTH_MS_TENANT",
      "default": "common",
      "description": "Microsoft tenant ID"
    },
    "require_pkce": {
      "type": "bool",
      "source": "env",
      "env_var": "AUTH_REQUIRE_PKCE",
      "default": true,
      "description": "Require PKCE for OAuth flows"
    },
    "require_nonce": {
      "type": "bool",
      "source": "env",
      "env_var": "AUTH_REQUIRE_NONCE",
      "default": true,
      "description": "Require nonce for OIDC flows"
    },
    "max_skew_seconds": {
      "type": "int",
      "source": "env",
      "env_var": "AUTH_MAX_SKEW_SECONDS",
      "default": 90,
      "description": "Maximum clock skew tolerance in seconds"
    },
    "role_store_type": {
      "type": "string",
      "source": "env",
      "env_var": "AUTH_ROLE_STORE_TYPE",
      "default": "mongodb",
      "description": "Document store type for persisting user roles"
    },
    "role_store_host": {
      "type": "string",
      "source": "env",
      "env_var": "AUTH_ROLE_STORE_HOST",
      "required": false,
      "description": "Role store host (defaults to copilot_storage env fallback)"
    },
    "role_store_port": {
      "type": "int",
      "source": "env",
      "env_var": "AUTH_ROLE_STORE_PORT",
      "required": false,
      "description": "Role store port (defaults to copilot_storage env fallback)"
    },
    "role_store_username": {
      "type": "string",
      "source": "env",
      "env_var": "AUTH_ROLE_STORE_USERNAME",
      "required": false,
      "description": "Role store username"
    },
    "role_store_password": {
      "type": "string",
      "source": "secret",
      "secret_name": "role_store_password",
      "required": false,
      "description": "Role store password"
    },
    "role_store_database": {
      "type": "string",
      "source": "env",
      "env_var": "AUTH_ROLE_STORE_DATABASE",
      "default": "auth",
      "description": "Role store database name"
    },
    "role_store_collection": {
      "type": "string",
      "source": "env",
      "env_var": "AUTH_ROLE_STORE_COLLECTION",
      "default": "user_roles",
      "description": "Collection name for role assignments"
    },
    "role_store_schema_dir": {
      "type": "string",
      "source": "env",
      "env_var": "AUTH_ROLE_STORE_SCHEMA_DIR",
      "required": false,
      "description": "Filesystem directory containing user role schema for validation"
    },
    "auto_approve_enabled": {
      "type": "bool",
      "source": "env",
      "env_var": "AUTH_AUTO_APPROVE_ENABLED",
      "default": false,
      "description": "Automatically approve first-time users into default roles"
    },
    "auto_approve_roles": {
      "type": "string",
      "source": "env",
      "env_var": "AUTH_AUTO_APPROVE_ROLES",
      "required": false,
      "description": "Comma-separated roles to grant when auto-approving users"
    },
    "first_user_auto_promotion_enabled": {
      "type": "bool",
      "source": "env",
      "env_var": "AUTH_FIRST_USER_AUTO_PROMOTION_ENABLED",
      "default": false,
      "description": "Enable auto-promotion of first user to admin (only for development/testing)"
    },
    "enable_dpop": {
      "type": "bool",
      "source": "env",
      "env_var": "AUTH_ENABLE_DPOP",
      "default": false,
      "description": "Enable DPoP proof-of-possession tokens"
    }
  }
}
