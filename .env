# SPDX-License-Identifier: MIT
# Copyright (c) 2025 Copilot-for-Consensus contributors

# =============================================================================
# USER-CONFIGURABLE OPTIONS (non-secret)
# Secrets now live in ./secrets and are mounted at /run/secrets
# =============================================================================

# LLM Backend Selection
# Options: 'local' (uses Ollama), 'azure', 'mock' (for testing)
LLM_BACKEND=local

# LLM Model (when using Ollama)
# Common models: mistral, llama2, neural-chat, openchat
LLM_MODEL=mistral

# Embedding Backend Selection
# Options: 'sentencetransformers' (local, offline), 'azure', 'huggingface'
EMBEDDING_BACKEND=sentencetransformers

# Metrics Backend Selection
# Options: 'noop' (local dev/testing), 'prometheus_pushgateway' (production)
METRICS_BACKEND=prometheus_pushgateway

# Consensus Detection Strategy
# Options: 'heuristic' (rule-based), 'mock' (testing), 'ml' (future ML-based)
CONSENSUS_DETECTOR_TYPE=heuristic

# =============================================================================
# AUTHENTICATION SERVICE CONFIGURATION
# =============================================================================

# Auth Service Settings
AUTH_ISSUER=https://localhost/ui
AUTH_AUDIENCES=copilot-for-consensus

# JWT Configuration
JWT_ALGORITHM=RS256
JWT_KEY_ID=default
JWT_DEFAULT_EXPIRY=1800

# OIDC Provider redirect URIs (client IDs/secrets are files in ./secrets)
# GitHub OAuth
AUTH_GITHUB_REDIRECT_URI=https://localhost/ui/callback

# Google OAuth
AUTH_GOOGLE_REDIRECT_URI=https://localhost/ui/callback

# Microsoft Entra ID
AUTH_MS_REDIRECT_URI=https://localhost/ui/callback
AUTH_MS_TENANT=common

# Security Settings
AUTH_REQUIRE_PKCE=true
AUTH_REQUIRE_NONCE=true
AUTH_MAX_SKEW_SECONDS=90
AUTH_ENABLE_DPOP=false

# First User Auto-Promotion Security
# WARNING: Setting this to 'false' creates a security risk in production!
# When enabled (false), the first user to authenticate will automatically receive admin privileges.
# This could allow an attacker to gain admin access if they authenticate before the legitimate admin.
# RECOMMENDATION: Keep this set to 'true' (default) and use bootstrap tokens to assign the initial admin.
# Only set to 'false' in isolated development/testing environments.
AUTH_DISABLE_FIRST_USER_AUTO_PROMOTION=true

# =============================================================================
# API GATEWAY TLS CONFIGURATION
# =============================================================================

# To enable HTTPS on the API Gateway (port 8443), provide TLS certificates
# as Docker secrets. See ./secrets/README.md and ./infra/nginx/certs/README.md
# for instructions.
#
# The gateway automatically detects if secrets are present and enables HTTPS.
# If secrets are not provided, only HTTP (port 8080) will be available.
#
# For local development/testing, use self-signed certificates:
#   ./infra/nginx/certs/generate-certs.sh
#   cp ./infra/nginx/certs/server.crt ./secrets/gateway_tls_cert
#   cp ./infra/nginx/certs/server.key ./secrets/gateway_tls_key
#
# For production, use CA-signed certificates from Let's Encrypt or your CA.

